# ============================
# webserv evaluation config (for review - safe version)
# ============================

# ----------------------------
# Main site (GET / POST / DELETE / CGI / routes)
# 127.0.0.1:8080
# ----------------------------
server {
    listen 8080 ;
    host 127.0.0.1;
    root ./docs/;

    # ----- error pages -----
    error_page 400 ./assets/errors/400.html;
    error_page 403 ./assets/errors/403.html;
    error_page 404 ./assets/errors/404.html;
    error_page 405 ./assets/errors/405.html;
    error_page 413 ./assets/errors/413.html;
    error_page 501 ./assets/errors/501.html;

    # ========================
    # / : 基本ルート
    # - GET: docs/index2.html
    # - POST: www/upload/ に保存
    # - max_body_size: 50 bytes → 413 テスト用
    # ========================
    location / {
        method GET POST;
        root ./docs/;
        index index2.html;

        # アップロード先（現状の構造に合わせて www/upload を使用）
        upload_path ./www/upload/;

        # body size limit
        max_body_size 50;
    }

    # ========================
    # /upload/ : アップロード済ファイル一覧
    #   物理パス: ./www/upload/
    # ========================
    location /upload/ {
        method GET;
        root ./www/;
        autoindex on;
        # /upload/xxx → ./www/upload/xxx を想定
    }

    # ========================
    # /list/ : docs/list/ ディレクトリ一覧
    # ========================
    location /list/ {
        method GET;
        root ./docs/list/;
        autoindex on;
    }

    # ========================
    # /delete/ : DELETE テスト用
    #   docs/delete/target.txt を事前に作成済み
    # ========================
    location /delete/ {
        method GET DELETE;
        root ./docs/delete/;
        autoindex on;
    }

    # ========================
    # /redirect_new/ : リダイレクト先として使う静的ページ
    # （本当の 301/302 リダイレクトは、あなたの実装の書式に合わせて
    #  後から location を追加しましょう）
    # ========================
    location /redirect_new/ {
        method GET;
        root ./docs/redirect_new/;
        index index.html;
    }

    # ========================
    # CGI 用 location
    #   既存の ./www/cgi-bin/ を使用
    #   /cgi/xxx.py → ./www/cgi-bin/xxx.py
    # ========================
    location /cgi/ {
        method GET POST;
        root ./www/cgi-bin/;
        cgi_path /usr/bin/python3;
        max_body_size 1024;
        autoindex off;
    }
}

# ----------------------------
# Sub site / static site / browser & siege
# 0.0.0.0:8081
# ----------------------------
server {
    listen 8081 ;
    host 0.0.0.0;
    root ./www/;

    # ----- error pages -----
    error_page 400 ./assets/errors/400.html;
    error_page 403 ./assets/errors/403.html;
    error_page 404 ./assets/errors/404.html;
    error_page 405 ./assets/errors/405.html;
    error_page 413 ./assets/errors/413.html;
    error_page 501 ./assets/errors/501.html;

    # ========================
    # / : 完全静的サイト
    #   ブラウザの Network タブで確認する用
    # ========================
    location / {
        method GET;
        root ./www/;
        index index.html;
        autoindex off;
    }

    # ========================
    # /dir/ : ディレクトリ一覧
    #   既存の www/list/ を利用
    # ========================
    location /dir/ {
        method GET;
        root ./www/list/;
        autoindex on;
    }

    # ========================
    # /empty.html : siege -b 用の軽いページ
    # ========================
    location /empty.html {
        method GET;
        root ./www/;
    }
}